variables:
  - name: python.version
    value: '3.8'
  - name: daal4py.version
    value: '2021.2.0'

pool:
  vmImage: 'ubuntu-20.04'
steps:
  - task: UsePythonVersion@0
    displayName: 'Use Python $(python.version)'
    inputs:
      versionSpec: '$(python.version)'
  - script: |
      pip install -r requirements-dev.txt
      pip install -r requirements-doc.txt
      ls $(python -m site --user-site)/../../../
    displayName: 'Install requirements'
  - script: |
      export DALROOT=$(python -m site --user-site)/../../../
      export LD_LIBRARY_PATH=${DALROOT}/lib:${LD_LIBRARY_PATH}
      echo $DALROOT
      export PKG_VERSION=$(daal4py.version)
      export NO_DIST=1
      python setup.py install --single-version-externally-managed --record=record.txt
    displayName: 'Build daal4py'
  - script: |
      cd doc
      make html
    displayName: 'Build documentation'

  - script: |
      cp -R doc/_build $(Build.ArtifactStagingDirectory)/html
    displayName: 'Copy build'

  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: 'daal4py-documentation'
      targetPath: '$(Build.ArtifactStagingDirectory)/html'
